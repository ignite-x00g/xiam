const qs=s=>document.querySelector(s),qsa=s=>[...document.querySelectorAll(s)];qsa('[data-modal]').forEach(b=>b.onclick=()=>qs('#'+b.dataset.modal).classList.add('active'));qsa('[data-close]').forEach(b=>b.onclick=()=>b.closest('.modal-overlay').classList.remove('active'));window.addEventListener('click',e=>qsa('.modal-overlay.active').forEach(m=>{if(e.target===m)m.classList.remove('active')}));window.addEventListener('keydown',e=>{if(e.key==='Escape')qsa('.modal-overlay.active').forEach(m=>m.classList.remove('active'))});qs('#menuToggle').onclick=()=>qs('#mobileNav').classList.toggle('active');qs('#mobile-services-toggle').onclick=()=>qs('#mobile-services-menu').classList.toggle('active');qs('#mobile-language-toggle').onclick=()=>{const en=qs('#mobile-language-toggle').textContent==='EN';qsa('[data-en]').forEach(el=>el.textContent=en?el.dataset.es:el.dataset.en);qsa('[data-placeholder-en]').forEach(el=>el.placeholder=en?el.dataset.placeholderEs:el.dataset.placeholderEn);qs('#mobile-language-toggle').textContent=en?'ES':'EN'};qs('#mobile-theme-toggle').onclick=()=>{const light=qs('#mobile-theme-toggle').textContent==='Light';document.body.classList.toggle('dark',light);qs('#mobile-theme-toggle').textContent=light?'Dark':'Light'};const langCtrl=qs('#langCtrl'),themeCtrl=qs('#themeCtrl');langCtrl.onclick=()=>{const es=langCtrl.textContent==='ES';document.documentElement.lang=es?'es':'en';langCtrl.textContent=es?'EN':'ES';qsa('[data-en]').forEach(n=>n.textContent=es?n.dataset.es:n.dataset.en);qsa('[data-placeholder-en]').forEach(n=>n.placeholder=es?n.dataset.placeholderEs:n.dataset.placeholderEn)};themeCtrl.onclick=()=>{const dark=themeCtrl.textContent==='Dark';document.body.classList.toggle('dark',dark);themeCtrl.textContent=dark?'Light':'Dark'};qsa('#joinModal .form-section').forEach(s=>{const inputs=qs('.inputs',s),add=qs('.add',s),rm=qs('.remove',s),acc=qs('.accept-btn',s),edt=qs('.edit-btn',s);if(!add)return;add.onclick=()=>{const ip=document.createElement('input');ip.placeholder=`Enter ${qs('h2',s).textContent}`;inputs.appendChild(ip);ip.focus()};rm.onclick=()=>inputs.lastElementChild&&inputs.removeChild(inputs.lastElementChild);acc.onclick=()=>{if(!inputs.children.length)return alert('Add at least one entry.');inputs.querySelectorAll('input').forEach(i=>i.disabled=true);s.classList.add('completed');acc.style.display='none';edt.style.display='inline-block'};edt.onclick=()=>{inputs.querySelectorAll('input').forEach(i=>i.disabled=false);s.classList.remove('completed');acc.style.display='inline-block';edt.style.display='none'}});qs('#joinForm').onsubmit=e=>{e.preventDefault();alert('Join form submitted');qs('#joinModal').classList.remove('active')};qs('#contactForm').onsubmit=e=>{e.preventDefault();alert('Contact form submitted');qs('#contactModal').classList.remove('active')};const log=qs('#chat-log'),form=qs('#chatbot-input-row'),input=qs('#chatbot-input'),send=qs('#chatbot-send'),guard=qs('#human-check');guard.onchange=()=>send.disabled=!guard.checked;function addMsg(t,c){const d=document.createElement('div');d.className='chat-msg '+c;d.textContent=t;log.appendChild(d);log.scrollTop=log.scrollHeight}form.onsubmit=async e=>{e.preventDefault();if(!guard.checked)return;const msg=input.value.trim();if(!msg)return;addMsg(msg,'user');input.value='';send.disabled=true;addMsg('…','bot');try{const r=await fetch('https://ops-ai-chatbot-worker.carlos-arias.workers.dev/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg})});const d=await r.json();log.lastChild.textContent=d.reply||'No reply.'}catch(err){console.error('Chatbot API error:', err); log.lastChild.textContent='Error: Can’t reach AI.'}send.disabled=false};
